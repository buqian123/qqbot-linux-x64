<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>系统设置</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>
        .layui-form-item .layui-input-company { width: auto; padding-right: 10px; line-height: 38px; }
    </style>
</head>
<body>
    <div class="layuimini-container">
        <div class="layuimini-main">
            <blockquote class="layui-elem-quote">
                请参照以下内容修改你的go-cqhttp 的config.yml配置，未列出的部分保存原来的配置内容或者直接 <a target="_blank" style="color:red" href="../static/config.yml">下载</a> 后覆盖文件。
                <p style="color:red">IP 地址填什么？</p> 执行命令：ifconfig -a 找到 docker0 下面一行 inet:xxx.xxx.xx..x 一般为 172.17.0.1， 或者直接服务器放行配置的两个端口配置外网IP
            </blockquote>
            <pre class="layui-code">servers:
  - http: # http协议设置
      host: 0.0.0.0 # 服务端监听地址
      port: 8000 # 服务端监听端口
  - ws: # 正向WS设置
      host: 0.0.0.0 # 正向WS服务器监听地址
      port: 8001 # 正向WS服务器监听端口</pre>
            <form class="layui-form layuimini-form" action="">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>机器人通讯配置</legend>
                </fieldset>
                <div class="layui-form-item">
                    <label class="layui-form-label required">Http协议</label>
                    <div class="layui-input-block">
                        <input type="text" name="cqhttpHttp" lay-verify="required" lay-reqtext="Http协议必填" placeholder="请参照填写示例填写，注意修改你的IP地址和端口号，填写示例：http://172.17.0.1:8000" autocomplete="off" class="layui-input">
                        <div class="layui-form-mid layui-word-aux">

                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label required">WS协议</label>
                    <div class="layui-input-block">
                        <input type="text" name="cqhttpWS" lay-verify="required" lay-reqtext="WS协议必填" placeholder="请参照填写示例填写，注意修改你的IP地址和端口号，填写示例：ws://172.17.0.1:8001" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <!--<div class="layui-form-item">
                    <label class="layui-form-label">accesstoken</label>
                    <div class="layui-input-block">
                        <input type="text" name="cqhttpWS" placeholder="go-cqhttp access token，默认不需要配置，这部分不想写说明了" autocomplete="off" class="layui-input">
                    </div>
                </div>-->
                <div class="layui-form-item">
                    <label class="layui-form-label">QQ群</label>
                    <div class="layui-input-block">
                        <input type="text" name="Groups" placeholder="请填写要监控的QQ群，多个用英文逗号隔开" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item ">
                    <label class="layui-form-label required">管理QQ</label>
                    <div class="layui-input-block">
                        <input type="text" name="ManagerQQ" lay-verify="required" lay-reqtext="管理QQ号码必填" placeholder="请输入机器人管理QQ号码" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item ">
                    <label class="layui-form-label required">Cookie检查</label>
                    <div class="layui-input-block">
                        <input type="text" name="CookieCheckCron" lay-verify="required" lay-reqtext="Cookie检查Cron表达式必填" placeholder="6位Cron表达式 0 0 * * * ?" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="setting">提交</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script src="../js/lay-config.js" charset="utf-8"></script>

    <script>
        layui.use(['form', 'jquery', 'common'], function () {
            var form = layui.form
                , layer = layui.layer
                , common = layui.common
                , $ = layui.jquery;

            layui.use('code', function () { //加载code模块
                layui.code(); //引用code方法
            });
            common.ajax("/SystemConfig", "get", {}, function (data) {
                if (data) {
                    console.log(data);
                    $("input[name=cqhttpHttp]").val(data.cqhttpHttp);
                    $("input[name=cqhttpWS]").val(data.cqhttpWS);
                    $("input[name=Groups]").val(data.Groups);
                    $("input[name=ManagerQQ]").val(data.ManagerQQ);
                    $("input[name=MaxQueryCount]").val(data.MaxQueryCount);
                    $("input[name=CookieCheckCron]").val(data.CookieCheckCron);
                    
                }
            });
            //监听提交
            form.on('submit(setting)', function (data) {
                layer.confirm('确认重新配置系统？', function (index) {
                    common.ajax("/SystemConfig", "post", JSON.stringify(data.field), function (data) {
                        if (data) {
                            layer.msg("系统配置生效！", { icon: 6 });
                        }
                    });
                });
                return false;
            });
        });
    </script>
</body>
</html>